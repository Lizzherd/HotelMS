<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>为入住添加服务</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div class="admin-layout">
    <div th:replace="~{fragments/admin-nav :: admin-nav}"></div>
    <main class="admin-content">
        <h2>为入住添加服务</h2>
        <p>入住房间: <strong th:text="${checkIn.roomNumber}"></strong> | 客户: <strong th:text="${checkIn.customerName}"></strong></p>

        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

        <h3>当前已选服务:</h3>
        <div th:if="${checkIn.services == null or checkIn.services.isEmpty()}">
            <p>暂无已选服务。</p>
        </div>
        <table th:unless="${checkIn.services == null or checkIn.services.isEmpty()}" class="table">
            <thead>
            <tr><th>服务名称</th><th>数量</th><th>单价</th><th>小计</th></tr>
            </thead>
            <tbody>
            <tr th:each="item : ${checkIn.services}">
                <td th:text="${item.serviceName}"></td><td th:text="${item.quantity}"></td>
                <td th:text="${'￥' + #numbers.formatDecimal(item.unitPrice, 1, 'COMMA', 2, 'POINT')}"></td>
                <td th:text="${'￥' + #numbers.formatDecimal(item.subtotal, 1, 'COMMA', 2, 'POINT')}"></td>
            </tr>
            </tbody>
            <tfoot>
            <tr><td colspan="3" style="text-align:right;">服务总计:</td><td th:text="${'￥' + #numbers.formatDecimal(checkIn.servicesCost, 1, 'COMMA', 2, 'POINT')}"></td></tr>
            </tfoot>
        </table>

        <h3>添加新服务:</h3>
        <form th:action="@{'/admin/checkins/addservice/' + ${checkIn.id}}" method="post">
            <div>
                <label for="serviceInfoId">选择服务:</label>
                <select id="serviceInfoId" name="serviceInfoId" required="required">
                    <option value="">请选择</option>
                    <option th:each="service : ${allServices}"
                            th:value="${service.id}"
                            th:text="${service.serviceName + ' (￥' + service.servicePrice + ')'}"></option>
                </select>
            </div>
            <div>
                <label for="quantity">数量:</label>
                <input type="number" id="quantity" name="quantity" min="1" value="1" required="required" />
            </div>
            <button type="submit">添加服务</button>
            <a th:href="@{'/admin/checkins/details/' + ${checkIn.id}}" class="button-cancel">返回详情</a>
        </form>
    </main>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>