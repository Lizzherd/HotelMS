<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>客房服务申请</title>
  <meta charset="UTF-8"/>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div class="container">
  <h2>客房服务申请</h2>
  <!-- 登录房间号表单 -->
  <form th:action="@{/user-service/login}" method="get" style="margin-bottom: 20px;">
    <label for="roomNumber">请输入房间号：</label>
    <input type="text" id="roomNumber" name="roomNumber" th:value="${roomNumber}" required>
    <button type="submit">登录</button>
  </form>

  <!-- 如果已找到入住记录 -->
  <div th:if="${checkIn != null}">
    <form th:action="@{/user-service/apply}" method="post" style="margin-bottom: 30px;">
      <input type="hidden" name="checkInId" th:value="${checkIn.id}"/>
      <label for="serviceInfoId">服务项目：</label>
      <select id="serviceInfoId" name="serviceInfoId" required>
        <option value="">请选择服务</option>
        <option th:each="service : ${allServices}"
                th:value="${service.id}"
                th:text="${service.serviceName + ' (￥' + service.servicePrice + ')'}"></option>
      </select>
      <label for="quantity">数量：</label>
      <input type="number" id="quantity" name="quantity" min="1" value="1" required>
      <button type="submit">申请服务</button>
    </form>

    <h3>本房间服务申请记录</h3>
    <table>
      <thead>
      <tr><th>项目</th><th>数量</th><th>状态</th><th>时间</th></tr>
      </thead>
      <tbody>
      <tr th:each="req : ${myRequests}">
        <td th:text="${req.serviceName}"></td>
        <td th:text="${req.quantity}"></td>
        <td>
          <span th:if="${req.status == 'APPLIED'}">申请中</span>
          <span th:if="${req.status == 'COMPLETED'}" style="color:green;">已完成</span>
          <span th:if="${req.status == 'REJECTED'}" style="color:red;">已拒绝</span>
        </td>
        <td th:text="${#temporals.format(req.requestTime, 'yyyy-MM-dd HH:mm')}"></td>
      </tr>
      </tbody>
    </table>
  </div>
  <!-- 如果没有入住记录 -->
  <div th:if="${checkIn == null}">
    <div class="alert alert-warning">未找到该房间的有效入住记录，请确认房间号或联系前台。</div>
  </div>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>